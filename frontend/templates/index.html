<!DOCTYPE html>
<html>
<head>
    <title>Inauguration Face Capture</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background: #f2f2f2; }
        #camera { border: 2px solid black; margin-top: 10px; }
        #countdown { font-size: 48px; color: red; font-weight: bold; }
        input, button { padding: 10px; margin: 10px; font-size: 16px; }
        button { background: green; color: white; border: none; cursor: pointer; }
        button:hover { background: darkgreen; }
    </style>
</head>
<body>

<h1>Welcome to the Inauguration!</h1>
<p>Please enter your name and click capture.</p>

<input type="text" id="name" placeholder="Enter your name">
<br>
<video id="camera" width="400" height="300" autoplay></video>
<div id="countdown"></div>
<br>
<button onclick="startCountdown()">Capture</button>

<script>
    let video = document.getElementById("camera");
    let countdownEl = document.getElementById("countdown");

    // Access webcam
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => { video.srcObject = stream; })
        .catch(err => { alert("Error accessing camera: " + err); });

    function startCountdown() {
        let name = document.getElementById("name").value.trim();
        if (!name) {
            alert("Please enter your name first!");
            return;
        }

        let counter = 3;
        countdownEl.textContent = counter;

        let interval = setInterval(() => {
            counter--;
            if (counter > 0) {
                countdownEl.textContent = counter;
            } else {
                clearInterval(interval);
                countdownEl.textContent = "";
                capturePhoto(name);
            }
        }, 1000);
    }

    function capturePhoto(name) {
        let canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        let context = canvas.getContext("2d");
        context.drawImage(video, 0, 0);

        let imgData = canvas.toDataURL("image/jpeg");

        fetch("/upload", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name: name, image: imgData })
        })
        .then(res => res.json())
        .then(data => { alert(data.message); })
        .catch(err => { alert("Upload failed: " + err); });
    }
</script>

</body>
</html>
